# â”€â”€â”€ flashcard-core/streamlit_app.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import os, sys
sys.path.insert(0, os.path.dirname(__file__))

import streamlit as st
from predict_level import predict_levels

# â”€â”€â”€ ãƒšãƒ¼ã‚¸è¨­å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="French Level Predictor")
st.title("ãƒ•ãƒ©ãƒ³ã‚¹èª å˜èªãƒ¬ãƒ™ãƒ«äºˆæ¸¬å™¨")

# â”€â”€â”€ ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@st.cache_resource(show_spinner=False)
def get_predict_fn():
    # predict_levels ã®ä¸­ã§ joblib.load ã—ã¦ã„ã‚‹ãªã‚‰ãã‚Œã‚’ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã›ã‚‹
    return predict_levels

# â”€â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆåˆæœŸåŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if "input_text" not in st.session_state:
    st.session_state["input_text"] = ""

def clear_input():
    st.session_state["input_text"] = ""

# â”€â”€â”€ å…¥åŠ› UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
text = st.text_input(
    "ãƒ•ãƒ©ãƒ³ã‚¹èªã®å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
    key="input_text"
)

col1, col2 = st.columns([1, 1])
with col1:
    predict_clicked = st.button("ãƒ¬ãƒ™ãƒ«ã‚’äºˆæ¸¬")
with col2:
    clear_clicked = st.button("ã‚¯ãƒªã‚¢", on_click=clear_input)

# â”€â”€â”€ äºˆæ¸¬ãƒ»è¡¨ç¤º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if predict_clicked:
    word = st.session_state.input_text.strip()
    if not word:
        st.warning("å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    else:
        # â‘  ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–ã—ãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ä¸€åº¦ã ã‘ãƒ­ãƒ¼ãƒ‰
        with st.spinner("ğŸ”„ ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ä¸­â€¦"):
            predict_fn = get_predict_fn()

        # â‘¡ äºˆæ¸¬å®Ÿè¡Œ
        with st.spinner("ğŸ”„ åˆ¤å®šä¸­â€¦"):
            level = predict_fn([word])[0]

        st.success(f"äºˆæ¸¬ãƒ¬ãƒ™ãƒ«: {level}")
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
